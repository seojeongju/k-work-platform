<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Viewers Test - Simple</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              wowcampus: {
                blue: '#1E40AF',
                light: '#E0F2FE',
                dark: '#0F172A'
              }
            }
          }
        }
      }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-6 py-8">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-8">ğŸ¯ Profile Viewers Functionality Test</h1>
            
            <!-- Test Status -->
            <div id="test-status" class="mb-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h2 class="text-lg font-semibold text-blue-800 mb-2">Test Status</h2>
                <p class="text-blue-700">Ready to run tests...</p>
            </div>

            <!-- Test Navigation -->
            <div class="mb-8">
                <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg">
                    <button id="tab-profile" class="px-6 py-4 text-sm font-medium rounded-lg border border-transparent text-gray-600 hover:text-gray-900">
                        <i class="fas fa-user mr-2"></i>í”„ë¡œí•„
                    </button>
                    <button id="tab-viewers" class="px-6 py-4 text-sm font-medium rounded-lg bg-white text-wowcampus-blue border border-wowcampus-blue">
                        <i class="fas fa-eye mr-2"></i>ì¡°íšŒ ê¸°ì—…
                    </button>
                </div>
            </div>

            <!-- Test Results -->
            <div id="test-results" class="space-y-6">
                <!-- This will be populated by tests -->
            </div>

            <!-- Viewers Content (From Implementation) -->
            <div id="content-viewers" class="tab-content">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-eye text-wowcampus-blue mr-2"></i>ë‚˜ì˜ í”„ë¡œí•„ì„ ì¡°íšŒí•œ ê¸°ì—…
                    </h3>
                    <div class="flex items-center space-x-3">
                        <select id="viewers-filter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                            <option value="all">ì „ì²´ ê¸°ê°„</option>
                            <option value="today">ì˜¤ëŠ˜</option>
                            <option value="week">ìµœê·¼ 7ì¼</option>
                            <option value="month">ìµœê·¼ 30ì¼</option>
                        </select>
                        <button onclick="refreshViewers()" class="text-wowcampus-blue hover:text-wowcampus-dark">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-eye text-blue-600 text-2xl mr-3"></i>
                            <div>
                                <p class="text-sm text-blue-600 font-medium">ì´ ì¡°íšŒìˆ˜</p>
                                <p id="total-views-count" class="text-xl font-bold text-blue-800">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-building text-green-600 text-2xl mr-3"></i>
                            <div>
                                <p class="text-sm text-green-600 font-medium">ì¡°íšŒ ê¸°ì—…ìˆ˜</p>
                                <p id="unique-companies-count" class="text-xl font-bold text-green-800">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-calendar-day text-orange-600 text-2xl mr-3"></i>
                            <div>
                                <p class="text-sm text-orange-600 font-medium">ì˜¤ëŠ˜ ì¡°íšŒ</p>
                                <p id="today-views-count" class="text-xl font-bold text-orange-800">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-calendar-week text-purple-600 text-2xl mr-3"></i>
                            <div>
                                <p class="text-sm text-purple-600 font-medium">ì´ë²ˆ ì£¼ ì¡°íšŒ</p>
                                <p id="week-views-count" class="text-xl font-bold text-purple-800">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Companies List -->
                <div class="bg-white border rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h4 class="text-lg font-semibold text-gray-900">ì¡°íšŒ ê¸°ì—… ëª©ë¡</h4>
                    </div>
                    <div id="profile-viewers-list" class="divide-y divide-gray-200">
                        <!-- Companies will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Test Action Buttons -->
            <div class="mt-8 flex space-x-4">
                <button onclick="runAllTests()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                    <i class="fas fa-play mr-2"></i>Run All Tests
                </button>
                <button onclick="loadViewersData()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-database mr-2"></i>Load Test Data
                </button>
                <button onclick="testFiltering()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors">
                    <i class="fas fa-filter mr-2"></i>Test Filtering
                </button>
                <button onclick="testInteractions()" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors">
                    <i class="fas fa-mouse-pointer mr-2"></i>Test Interactions
                </button>
            </div>
        </div>
    </div>

    <script>
        // Test Implementation (Based on the actual implementation)
        let testViewers = [];
        let testResults = [];

        function getTestProfileViewers() {
            return [
                {
                    id: 1,
                    company_name: 'í…Œí¬ ì´ë…¸ë² ì´ì…˜',
                    company_logo: null,
                    industry: 'IT/ì†Œí”„íŠ¸ì›¨ì–´',
                    company_size: 'medium',
                    view_count: 5,
                    last_viewed_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                    first_viewed_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    location: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬',
                    description: 'í˜ì‹ ì ì¸ ê¸°ìˆ  ì†”ë£¨ì…˜ ê°œë°œ'
                },
                {
                    id: 2,
                    company_name: 'ê¸€ë¡œë²Œ ì†Œí”„íŠ¸',
                    company_logo: null,
                    industry: 'ì†Œí”„íŠ¸ì›¨ì–´',
                    company_size: 'large',
                    view_count: 3,
                    last_viewed_at: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
                    first_viewed_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    location: 'ì„œìš¸ì‹œ ì„œì´ˆêµ¬',
                    description: 'ê¸€ë¡œë²Œ ì†Œí”„íŠ¸ì›¨ì–´ ì„œë¹„ìŠ¤'
                },
                {
                    id: 3,
                    company_name: 'ìŠ¤íƒ€íŠ¸ì—… ì½”ë¦¬ì•„',
                    company_logo: null,
                    industry: 'í•€í…Œí¬',
                    company_size: 'startup',
                    view_count: 2,
                    last_viewed_at: new Date(Date.now() - 8 * 60 * 60 * 1000).toISOString(),
                    first_viewed_at: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    location: 'ê²½ê¸°ë„ ì„±ë‚¨ì‹œ',
                    description: 'í˜ì‹ ì ì¸ í•€í…Œí¬ ì†”ë£¨ì…˜'
                },
                {
                    id: 4,
                    company_name: 'ì œì¡°ì—… ë¦¬ë”ìŠ¤',
                    company_logo: null,
                    industry: 'ì œì¡°ì—…',
                    company_size: 'large',
                    view_count: 4,
                    last_viewed_at: new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString(),
                    first_viewed_at: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                    location: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬',
                    description: 'ì²¨ë‹¨ ì œì¡° ê¸°ìˆ ì˜ ì„ ë„ê¸°ì—…'
                },
                {
                    id: 5,
                    company_name: 'ë””ìì¸ ìŠ¤íŠœë””ì˜¤',
                    company_logo: null,
                    industry: 'ë””ìì¸',
                    company_size: 'small',
                    view_count: 1,
                    last_viewed_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
                    first_viewed_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
                    location: 'ëŒ€êµ¬ì‹œ ì¤‘êµ¬',
                    description: 'ì°½ì˜ì ì¸ ë””ìì¸ ì†”ë£¨ì…˜'
                }
            ];
        }

        function formatRelativeTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);

            if (diffHours < 1) {
                return 'ë°©ê¸ˆ ì „';
            } else if (diffHours < 24) {
                return `${diffHours}ì‹œê°„ ì „`;
            } else if (diffDays < 7) {
                return `${diffDays}ì¼ ì „`;
            } else {
                return date.toLocaleDateString();
            }
        }

        function updateViewerStats(viewers) {
            const totalViews = viewers.reduce((sum, viewer) => sum + viewer.view_count, 0);
            const uniqueCompanies = viewers.length;
            
            // Calculate today and week views
            const now = new Date();
            const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekStart = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            const todayViewers = viewers.filter(viewer => 
                new Date(viewer.last_viewed_at) >= todayStart
            );
            const weekViewers = viewers.filter(viewer => 
                new Date(viewer.last_viewed_at) >= weekStart
            );
            
            const todayViews = todayViewers.reduce((sum, viewer) => sum + viewer.view_count, 0);
            const weekViews = weekViewers.reduce((sum, viewer) => sum + viewer.view_count, 0);

            // Update display
            document.getElementById('total-views-count').textContent = totalViews;
            document.getElementById('unique-companies-count').textContent = uniqueCompanies;
            document.getElementById('today-views-count').textContent = todayViews;
            document.getElementById('week-views-count').textContent = weekViews;

            return { totalViews, uniqueCompanies, todayViews, weekViews };
        }

        function renderProfileViewers(viewers) {
            const container = document.getElementById('profile-viewers-list');
            
            if (viewers.length === 0) {
                container.innerHTML = `
                    <div class="px-6 py-8 text-center text-gray-500">
                        <i class="fas fa-eye text-4xl mb-4"></i>
                        <p>ì•„ì§ í”„ë¡œí•„ì„ ì¡°íšŒí•œ ê¸°ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = viewers.map(viewer => createViewerCard(viewer)).join('');
        }

        function createViewerCard(viewer) {
            const lastViewed = formatRelativeTime(viewer.last_viewed_at);
            const firstViewed = formatRelativeTime(viewer.first_viewed_at);
            
            return `
                <div class="p-6 hover:bg-gray-50 transition-colors">
                    <div class="flex items-start space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <i class="fas fa-building text-white text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h4 class="text-lg font-semibold text-gray-900">${viewer.company_name}</h4>
                                    <p class="text-sm text-gray-600">${viewer.industry} â€¢ ${viewer.location}</p>
                                    <p class="text-sm text-gray-500 mt-1">${viewer.description}</p>
                                </div>
                                <div class="flex flex-col items-end space-y-2">
                                    <span class="px-3 py-1 text-sm font-medium bg-blue-100 text-blue-800 rounded-full">
                                        ${viewer.view_count}íšŒ ì¡°íšŒ
                                    </span>
                                    <span class="px-2 py-1 text-xs font-medium ${getCompanySizeBadgeClass(viewer.company_size)} rounded-full">
                                        ${getCompanySizeLabel(viewer.company_size)}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="mt-3 flex items-center space-x-6 text-sm text-gray-500">
                                <span><i class="fas fa-clock mr-1"></i>ë§ˆì§€ë§‰ ì¡°íšŒ: ${lastViewed}</span>
                                <span><i class="fas fa-calendar mr-1"></i>ì²« ì¡°íšŒ: ${firstViewed}</span>
                            </div>
                            
                            <div class="mt-4 flex items-center space-x-3">
                                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
                                        onclick="viewCompanyDetail(${viewer.id})">
                                    <i class="fas fa-info-circle mr-1"></i>ìƒì„¸ë³´ê¸°
                                </button>
                                <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
                                        onclick="contactCompany(${viewer.id})">
                                    <i class="fas fa-envelope mr-1"></i>ì—°ë½í•˜ê¸°
                                </button>
                                <button class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm"
                                        onclick="blockCompany(${viewer.id})">
                                    <i class="fas fa-ban mr-1"></i>ì°¨ë‹¨í•˜ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getCompanySizeBadgeClass(size) {
            const classes = {
                large: 'bg-purple-100 text-purple-800',
                medium: 'bg-blue-100 text-blue-800',
                small: 'bg-green-100 text-green-800',
                startup: 'bg-orange-100 text-orange-800'
            };
            return classes[size] || 'bg-gray-100 text-gray-800';
        }

        function getCompanySizeLabel(size) {
            const labels = {
                large: 'ëŒ€ê¸°ì—…',
                medium: 'ì¤‘ê²¬ê¸°ì—…',
                small: 'ì¤‘ì†Œê¸°ì—…',
                startup: 'ìŠ¤íƒ€íŠ¸ì—…'
            };
            return labels[size] || 'ê¸°íƒ€';
        }

        // Test Functions
        function loadViewersData() {
            console.log('Loading profile viewers test data...');
            testViewers = getTestProfileViewers();
            
            const stats = updateViewerStats(testViewers);
            renderProfileViewers(testViewers);
            
            addTestResult('âœ… Data Loading', 'Successfully loaded test data', 
                `${testViewers.length} companies, ${stats.totalViews} total views`);
            
            console.log('Profile viewers loaded:', testViewers);
            return true;
        }

        function testFiltering() {
            if (testViewers.length === 0) {
                loadViewersData();
            }
            
            console.log('Testing filtering functionality...');
            let allTestsPassed = true;
            
            // Test period filters
            const periods = ['all', 'today', 'week', 'month'];
            periods.forEach(period => {
                document.getElementById('viewers-filter').value = period;
                // Simulate filtering logic
                const filtered = applyPeriodFilter(testViewers, period);
                console.log(`Period filter '${period}':`, filtered.length, 'results');
            });
            
            addTestResult('âœ… Filtering', 'Filter functionality working', 
                'Period filters tested successfully');
            return allTestsPassed;
        }

        function applyPeriodFilter(viewers, period) {
            const now = new Date();
            let cutoffDate;
            
            switch (period) {
                case 'today':
                    cutoffDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    break;
                case 'week':
                    cutoffDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    break;
                case 'month':
                    cutoffDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    break;
                default:
                    return viewers;
            }
            
            return viewers.filter(viewer => new Date(viewer.last_viewed_at) >= cutoffDate);
        }

        function testInteractions() {
            console.log('Testing interaction functionality...');
            
            // Test each interaction
            const interactions = ['viewCompanyDetail', 'contactCompany', 'blockCompany'];
            let allTestsPassed = true;
            
            interactions.forEach(interaction => {
                try {
                    // Test if function exists
                    if (typeof window[interaction] === 'function') {
                        console.log(`âœ… ${interaction} function exists`);
                    } else {
                        console.error(`âŒ ${interaction} function not found`);
                        allTestsPassed = false;
                    }
                } catch (error) {
                    console.error(`âŒ Error testing ${interaction}:`, error);
                    allTestsPassed = false;
                }
            });
            
            addTestResult(allTestsPassed ? 'âœ… Interactions' : 'âŒ Interactions', 
                allTestsPassed ? 'All interaction functions available' : 'Some interaction functions missing',
                `Tested ${interactions.length} interaction functions`);
            return allTestsPassed;
        }

        function runAllTests() {
            console.log('ğŸ§ª Running all tests...');
            testResults = [];
            
            updateTestStatus('ğŸ”„ Running tests...', 'Running comprehensive functionality tests');
            
            const dataTest = loadViewersData();
            const filterTest = testFiltering();
            const interactionTest = testInteractions();
            
            const allPassed = dataTest && filterTest && interactionTest;
            
            updateTestStatus(
                allPassed ? 'âœ… All tests passed!' : 'âš ï¸ Some tests failed',
                allPassed ? 'Profile viewers functionality is working correctly' : 'Some issues detected - check results below'
            );
            
            // Summary
            addTestResult('ğŸ“‹ Test Summary', 
                `${testResults.filter(r => r.status.startsWith('âœ…')).length}/${testResults.length} tests passed`,
                'Test run completed'
            );
            
            console.log('ğŸ All tests completed');
            return allPassed;
        }

        function addTestResult(status, title, description) {
            testResults.push({ status, title, description, timestamp: new Date().toLocaleTimeString() });
            
            const container = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `p-4 rounded-lg border ${status.startsWith('âœ…') ? 'bg-green-50 border-green-200' : 
                status.startsWith('âš ï¸') ? 'bg-yellow-50 border-yellow-200' : 'bg-red-50 border-red-200'}`;
            
            resultDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <span class="text-lg">${status}</span>
                    <div class="flex-1">
                        <h4 class="font-semibold">${title}</h4>
                        <p class="text-sm text-gray-600">${description}</p>
                        <span class="text-xs text-gray-500">${testResults[testResults.length - 1].timestamp}</span>
                    </div>
                </div>
            `;
            
            container.appendChild(resultDiv);
        }

        function updateTestStatus(title, description) {
            const statusDiv = document.getElementById('test-status');
            statusDiv.innerHTML = `
                <h2 class="text-lg font-semibold text-blue-800 mb-2">${title}</h2>
                <p class="text-blue-700">${description}</p>
            `;
        }

        // Company Interaction Functions
        function viewCompanyDetail(companyId) {
            const company = testViewers.find(v => v.id === companyId);
            alert(`íšŒì‚¬ ìƒì„¸ë³´ê¸°: ${company ? company.company_name : `ID ${companyId}`}\\n\\nê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!`);
            console.log('View company detail:', companyId, company);
        }

        function contactCompany(companyId) {
            const company = testViewers.find(v => v.id === companyId);
            alert(`ì—°ë½í•˜ê¸°: ${company ? company.company_name : `ID ${companyId}`}\\n\\nì—°ë½ ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!`);
            console.log('Contact company:', companyId, company);
        }

        function blockCompany(companyId) {
            const company = testViewers.find(v => v.id === companyId);
            if (confirm(`'${company ? company.company_name : `ID ${companyId}`}'ì„(ë¥¼) ì°¨ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                alert('ì°¨ë‹¨ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\\n\\nì°¨ë‹¨ ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!');
                console.log('Block company:', companyId, company);
            }
        }

        function refreshViewers() {
            console.log('Refreshing viewers data...');
            loadViewersData();
            alert('ë°ì´í„°ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Profile Viewers Test Page Loaded');
            updateTestStatus('ğŸ¯ Ready to Test', 'Click "Run All Tests" to verify all functionality');
            
            // Auto-load test data for immediate visualization
            setTimeout(() => {
                loadViewersData();
            }, 1000);
        });
    </script>
</body>
</html>